<html>
	<head>
		<title>Smart dictionary settings</title>
		<script src="json.js" type="text/javascript"></script>
		<script src="alert.js" type="text/javascript"></script>
		<script  type="text/javascript">
		
		
		//Убираем символы экранирования
		function CopyStr(str){
			var NewStr = "";
			for(var i=0; i<str.length; i++){
				if(str.charAt(i) != "\\") NewStr = NewStr+str.charAt(i);
			}
			return NewStr;
		}
		
		//сохраняем логин и пароль от сайта в localStorage
		function SafeSettings(){
			var password = document.getElementById('password').value;
			var login = document.getElementById('login').value;
			
			//проверяем пароль и логин
				 var auth = "login="+login+"&password="+password;
				  var xmlhttp = new XMLHttpRequest();
				  xmlhttp.open('POST', 'http://lang.omich.net/smdserver/servlet/login', true);
				  xmlhttp.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded; charset=UTF-8');
					xmlhttp.onreadystatechange = function() {
						if (xmlhttp.readyState == 4) {
							if(xmlhttp.status == 200) {
								var AuthRes = JSON.parse(CopyStr(xmlhttp.responseText));
									localStorage["auth"] = AuthRes.success;
									
									if(AuthRes.success){
										localStorage["password"] = password;
										localStorage["login"] = login;
										SendAlert("Логин и пароль введены верно");
									}else{
											localStorage["login"] ="";
											localStorage["pasword"] = "";
										
										
										document.getElementById('password').value="";
										document.getElementById('login').value="";
										SendAlert("Логин или пароль введен неверно");
									}
							}else{
								SendAlert(xmlhttp.statusText);
							}
						}
					}
					xmlhttp.send(auth);
				
			
			
		}
		//загружаем логин и пароль от сайта из localStorage
		function LoadSettings(){
			if(localStorage["auth"] == "true"){
				var login = localStorage["login"];
				var password = localStorage["password"];
				document.getElementById('login').value = login;
				document.getElementById('password').value = password;
			}
		}
		</script>
		
	</head>
	<body onload="LoadSettings()">
		<div>
			<table>
				<tr>
					<td>login:</td>
					<td><input type="text" id="login" value=""></td>
				</tr>
				
				<tr>
					<td>password</td>
					<td><input type="password" id="password" value=""></td>
				</tr>
				
				<tr>
					<td></td>
					<td align="right"><input type="button" id="save" value="Сохранить" onclick="SafeSettings()"></td>
				</tr>
			</table>
		</div>
	</body>
</html>