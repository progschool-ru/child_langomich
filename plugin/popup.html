<html>
	<head>
		<script src="jquery-1.7.min.js" type="text/javascript"></script>
		<script src="lib.js" type="text/javascript"></script>
		<script type="text/javascript">
				var form = new Form('test');
				function add(){
					sendAlert("Слово добавлено на сервер");
				};
		
				//проверяет подошел ли логин и пароль
				//тут не нужна т.к уже проверили в настройках
				//но стои сделать проверку на доступность сервера
				
				function checkAuthData(success){
				};
				
				//загружаем языки
				function setLanguages(languages){
					//а если нету языков ?
					languages.languages.forEach(function(item){
						$('select').append( $('<option value="'+item.id+'">'+item.name+'</option>'));
						}
					)
				};
				
				//функция добавления слова на сервер
				function addWordToServer(){
					if($('#word0').attr('value') == ""){
						sendAlert("Поле Слово пустое"); return;
					}
					if($('#translate0').attr('value') == ""){
						sendAlert("Поле Переводэ пустое"); return;
					}
				
					SMDServer.auth(checkAuthData);
					Words.setLanguage($('#languages :selected').val(),$('#languages :selected').text());
					Words.addWord($('#translate0').attr('value'), $('#word0').attr('value'));
					SMDServer.sendWords(Words.getData(), add);
					Words.clearWords();
				};

				//при запуске popup об этом посылается сообщения на фоновую страницу
				window.addEventListener("load", function(){
					
					form.addInputStr();
					
					if(localStorage["auth"] =="true"){
						chrome.extension.sendRequest({message : "StartPopup"}, function(Response){
							$('#word0').attr('value',Response.nowText);	
						});
						form.createForm("addWordToServer");
						SMDServer.setAuthData(localStorage["login"],localStorage["password"]);
						SMDServer.auth(checkAuthData);
						SMDServer.loadLanguages(setLanguages);
					}else{
						$('#words').append($('<div align="center">Введите настройки для авторизации</div>'));
					}			
					
				}, true)
		</script>
	</head>
	<body>
	<input type=hidden value="">
			<div id="test">
			</div>    
 	</body>
<html>
