<html>
	<head>
		<script src="jquery-1.7.min.js" type="text/javascript"></script>
		<script src="lib.js" type="text/javascript"></script>
		<script type="text/javascript">
				
				function add(){
					sendAlert("Слово добавлено на сервер");
				};
		
				//проверяет подошел ли логин и пароль
				//тут не нужна т.к уже проверили в настройках
				//но стои сделать проверку на доступность сервера
				
				function checkAuthData(success){
				};
				
				//загружаем языки
				function setLanguages(languages){
					//а если нету языков ?
					languages.languages.forEach(function(item){
						$('#languages').append( $('<option value="'+item.id+'">'+item.name+'</option>'));
						}
					)
				};
				
				//функция добавления слова на сервер
				function addWordToServer(){
					//навести порядок
					if($('#word').attr('value') == ""){
						sendAlert("Поле Слово пустое"); return;
					}
					if($('#translate').attr('value') == ""){
						sendAlert("Поле Переводэ пустое"); return;
					}
				
					SMDServer.auth(checkAuthData);
					Words.setLanguage($('#languages :selected').val(),$('#languages :selected').text());
					Words.addWord($('#translate').attr('value'), $('#word').attr('value'));
					SMDServer.sendWords(Words.getData(), add);
					Words.clearWords();
				};

				//при запуске popup об этом посылается сообщения на фоновую страницу
				window.addEventListener("load", function(){
						if(localStorage["auth"] =="true"){
					$('#words').append($('<tr><td>Слово</td><td>Язык</td><td>Перевод</td></tr>'));
					$('#words').append($('<tr><td><input type=text id="word" value=""></td><td><select name="ComboBox" id="languages"></select></td><td><input type=text id="translate" value=""></td></tr>'));
					$('#button').append($('<input type=button name="add" value="Добавить" onclick="addWordToServer()">'));
					chrome.extension.sendRequest({message : "StartPopup"}, function(Response){
					document.getElementById('word').value = Response.nowText;		
					});
					SMDServer.setAuthData(localStorage["login"],localStorage["password"]);
					SMDServer.auth(checkAuthData);
					SMDServer.loadLanguages(setLanguages);
					}else{
						$('#words').append($('<div align="center">Введите настройки для авторизации</div>'));
					}		
				}, true)
		</script>
	</head>
	<!-- Cделать динамичную форму-->
	<body>

		
		
				<table id="words">
					
		
				</table>
			    
 			<div align="right" id="button"></div>
  </body>
<html>
