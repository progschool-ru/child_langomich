<html>
	<head>
		<script src="jquery-1.7.min.js" type="text/javascript"></script>
		<script src="lib.js" type="text/javascript"></script>
		<script type="text/javascript">
				
				//проверяет подошел ли логин и пароль
				//тут не нужна т.к уже проверили в настройках
				//но стои сделать проверку на доступность сервера
				function checkAuthData(success){
				};
				
				//загружаем языки
				function setLanguages(languages){
					//а если нету языков ?
					languages.languages.forEach(function(item){
						$("#languages").append( $('<option value="'+item.id+'">'+item.name+'</option>'));
						}
					)
				};
				
				
				//функция добавления слова на сервер
				function addWordToServer(){
				  var word = document.getElementById('word');
				  var translate = document.getElementById('translate');
				
				SMDServer.setAuthData(localStorage["login"],localStorage["password"]);
				//Нужно как нибудь проверять авторизованы ли мы на сервере или нет
				//что бы не делать этот запрос каждый раз при нажатии кнопки добавить
				SMDServer.auth(checkAuthData);
						
						
				};

				//при запуске popup об этом посылается сообщения на фоновую страницу
				window.addEventListener("load", function(){
					chrome.extension.sendRequest({message : "StartPopup"}, function(Response){
					// и получаем ответ в котором содежится выделеный текст
					document.getElementById('word').value = Response.nowText;
					
					//так же надо добавить анимацию пока все загружаем
					
					//тут проверяем сохранен ли логин или пароль, если да 
					//загружаем список языков
					//и отображем форму с выделеным словом
					if(localStorage["auth"] =="true"){
							SMDServer.setAuthData(localStorage["login"],localStorage["password"]);
							SMDServer.auth(checkAuthData);
							SMDServer.loadLanguages(setLanguages);
					}else{
						//если нет то отображем введите логин и пароль в настройках
						sendAlert("вы не авторизованы");
					}
				
					});
				}, true)
		</script>
	</head>
	<body>

		<div>
			<div id="add_word">
				<table>
					<tr>
						<td>Слово</td>
						<td>Язык</td>
						<td>Перевод</td>
					</tr>
		
					<tr>
						<td><input type=text id="word" value=""></td>
						<td><select name="ComboBox" id="languages"></select></td>
					<td><input type=text id="translate" value=""></td>
					</tr>
		
					<tr>
					<td></td>
					<td><!--<input type=button name="translate" value="Пепевести">--></td>
					<td align=right><input type=button name="add" value="Добавить" onclick="addWordToServer()"></td>
					</tr>
				</table>
			    
 
     </body>
<html>