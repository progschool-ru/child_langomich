<html>
	<head>
		<style  type="text/css">
		body{
			width: 381px;
		}
		#table{
			display: none;
		}
		#input{
			height: 81px;
			vertical-align: middle;
			text-align:	center;
			display: table-cell;
		}
		.content{
		}
		</style>
		<script src="jquery-1.7.min.js" type="text/javascript"></script>
		<script src="lib.js" type="text/javascript"></script>
		<script type="text/javascript">
				var form = new Form('table');
				
				function add(){
					sendAlert("Слово добавлено на сервер");
				};		
				//загружаем языки
				function setLanguages(languages){
					//а если нету языков ?
					languages.languages.forEach(function(item){
						$('select').append( $('<option value="'+item.id+'">'+item.name+'</option>'));
						}
					)
					//убираем картинку с загрузкой и показываем форму
					$('#input').remove();
					$('#table').show();
				};
				
				//функция добавления слова на сервер
				function addWordToServer(){
					if($('#word0').attr('value') == ""){
						sendAlert("Поле Слово пустое"); return;
					}
					if($('#translate0').attr('value') == ""){
						sendAlert("Поле Перевод пустое"); return;
					}
				
					SMDServer.auth(function(success){});
					Words.setLanguage($('#languages :selected').val(),$('#languages :selected').text());
					Words.addWord($('#translate0').attr('value'), $('#word0').attr('value'));
					SMDServer.sendWords(Words.getData(), add);
					Words.clearWords();
				};

				
				chrome.extension.onRequest.addListener(	
					function(request, sender, sendResponse){
						
						SMDServer.setAuthData(localStorage["login"],localStorage["password"]);
						SMDServer.auth(function(success){});
												
						if(request.message == "SendNowText"){
							form.addWords(request.NowText);
						}
						
						form.createForm("addWordToServer");	
						SMDServer.loadLanguages(setLanguages);
						
					}
				);
				
				
				//при запуске popup об этом посылается сообщения на фоновую страницу
				window.addEventListener("load", function(){
					if(localStorage["auth"] =="true"){
						$('#input').append('<span class="content">Загрузка языков</span>');
						chrome.extension.sendRequest({message : "StartPopup"});
					}else{
						$('#input').append($('<span class="content">Введите <a href="settings.html" target="_blank"> настройки</a> для авторизации</span>'));
					}			
					
				}, true)
		</script>
	</head>
	<body>
		<center>
			<div id="table"></div>  
			<div id="input"></div>
		</center>
 	</body>
<html>
